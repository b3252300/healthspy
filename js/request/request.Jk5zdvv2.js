import{a as e}from"../axios/axios.CmLmLvTV.js";import{u as t,c as s,a,r,p as o}from"../../assets/index-BGBnUB5j.js";import{C as n}from"../crypto-js/crypto-js.7wHo0WA-.js";import{e as i}from"../EncryptStorage/EncryptStorage.CPcoWq5g.js";import{d}from"../pinia/pinia.BbQN6uKc.js";const c="vite__token",p=d({id:"users",state:()=>({token:s.get(c)}),actions:{SET_TOKEN(e=""){e?s.set(c,e):s.remove(c),this.token=e},RESET_INFO:()=>new Promise(e=>{const r=t();s.clearAll(),a(),r.DEL_ALL_VIEWS(null),e()})}}),l=d({id:"app",state:()=>({sidebar:{opened:!s.get("sidebarStatus")||!!+s.get("sidebarStatus"),withoutAnimation:!1},size:s.get("size")||"default",lang:s.get("lang")||"zh-CN",Role:s.get("Role")||"0",ApiRootUrl:s.get("apiRootUrl")||"",embeddedWebViewFrameMode:s.get("FrameMode")||"false"}),actions:{TOGGLE_SIDEBAR(){this.sidebar.opened=!this.sidebar.opened,this.sidebar.withoutAnimation=!1,this.sidebar.opened?s.set("sidebarStatus",1):s.set("sidebarStatus",0)},CLOSE_SIDEBAR(e){s.set("sidebarStatus",0),this.sidebar.opened=!1,this.sidebar.withoutAnimation=e},TOGGLE_DEVICE(e){this.device=e},SET_SIZE(e){this.size=e,s.set("size",e)},SET_LANG(e){this.lang=e,s.set("lang",e)},SET_ROLE(e){this.Role=e,s.set("Role",e)},SET_ApiRootUrl(e){this.ApiRootUrl=e,s.set("apiRootUrl",e)},SET_FrameMode(e){this.embeddedWebViewFrameMode=e,s.set("FrameMode",e)}}});const{Logout:h}=o();const m=new class{constructor(){this.baseUrl="http://192.168.26.194/LandSeed.HealthMemberWebApi",this.withCredentials=!1}getConfig(){var e="http://192.168.26.194/LandSeed.HealthMemberWebApi";l().SET_ApiRootUrl(e);return{baseURL:e,headers:{"Content-Type":"text/plain"}}}getParams(e){const{method:t,data:s}=e;return["post","put","patch","delete"].indexOf(t)>=0?e.Data=JSON.stringify(s):(e.params=JSON.stringify(s),delete e.Data),e}checkStatus(e){let t="";const s=p();switch(e){case 400:t="錯誤請求";break;case 401:t="未授權，請重新登入",s.SET_TOKEN();break;case 403:t="拒絕訪問";break;case 404:t="請求錯誤，未找到該資源";break;case 405:t="請求方法未允許";break;case 408:t="請求超時";break;case 500:t="服務器端出錯";break;case 501:t="網絡未實現";break;case 502:t="網絡錯誤";break;case 503:t="服務不可用";break;case 504:t="網絡超時";break;case 505:t="HTTP 版本不支持該請求";break;default:t="連接錯誤"}return t}setInterceptors(e){const{EncryptInit:t,DecryptInit:s}=function(){const e="VZ0d4nGht3wJm6Kha0hTdxPxBPdW2Bw5",t="QfDhOdv1hmDEX6Dw";return{EncryptInit:s=>n.AES.encrypt(JSON.stringify(s),n.enc.Latin1.parse(e),{iv:n.enc.Latin1.parse(t),mode:n.mode.CBC,padding:n.pad.Pkcs7}).toString(),DecryptInit:s=>JSON.parse(n.AES.decrypt(s,n.enc.Latin1.parse(e),{iv:n.enc.Latin1.parse(t),mode:n.mode.CBC,padding:n.pad.Pkcs7}).toString(n.enc.Utf8))}}(),a=this;e.interceptors.request.use(e=>{const a=i.getItem("Token");console.log(a,"有",r.currentRoute.value.meta.typeName),a||r.currentRoute.value.name||(window.location.href=h.path,localStorage.removeItem("refreshCount"),localStorage.removeItem("rowId"));const{data:o}=e,n=t({token:a,data:o});e.data=n;const d=s(n);return console.log(d,"送出(解密) request2"),console.log(e),e},e=>(r.push({path:"/404"}),Promise.reject(new Error(e)))),e.interceptors.response.use(e=>{var t;try{const a=s(e.data),{code:r,message:o,statusCode:n}=a;(null==(t=null==a?void 0:a.data)?void 0:t.Token)&&i.setItem("Token",a.data.Token);let d=a;return console.log(d,"response"),d}catch(a){if(r.push({path:"/404"}),"SyntaxError: Unexpected end of JSON input"==a){return e.data}}},e=>(e&&e.response&&(e.message=a.checkStatus(e.status),window.$FailedAlert&&window.$FailedAlert({Content:e.message+" "+e.status,IsShow:!0})),r.push({path:"/404"}),console.log(e,"error"),Promise.reject(new Error(e.message))))}request(t){const s=e.create(),a=this.getConfig(),r=Object.assign({},a,this.getParams(t));return this.setInterceptors(s),s(r)}};export{m as h};
